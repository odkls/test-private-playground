name: Move Issue to In Progress Pipeline

on:
  create:
    branches:
      - "**"

jobs:
  filter-branch:
    runs-on: ubuntu-latest
    outputs:
      continue: ${{ steps.filter.outputs.continue }} # ë¸Œëœì¹˜ ì´ë¦„ í˜•ì‹ì´ ë§ì•„ ì•¡ì…˜ì„ ì‹¤í–‰í• ì§€ ì—¬ë¶€
    steps:
      # ì•¡ì…˜ì„ ì‹¤í–‰í•  í˜•ì‹ì˜ ë¸Œëœì¹˜ ì´ë¦„ì„ í•„í„°ë§
      # ì˜ˆ: feat/#1-branche-name, fix/#2-branch-name
      - name: filter branch name
        id: filter
        run: |
          branch_name="${{ github.ref_name }}" # ë¸Œëœì¹˜ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
          regex='^[a-zA-Z]+/#[0-9]+-.*$' # ì •ê·œì‹: "[a-zA-Z]*/#[0-9]-*"

          # ì •ê·œì‹ì— ë§ì§€ ì•ŠëŠ” ë¸Œëœì¹˜ ì´ë¦„ì´ë©´ ì•¡ì…˜ ì¢…ë£Œ
          if [[ ! "$branch_name" =~ $regex ]]; then
            echo "ğŸ’¬ ì•¡ì…˜ì„ ì‹¤í–‰í•  ë¸Œëœì¹˜ í˜•ì‹ì´ ì•„ë‹ˆë¯€ë¡œ ì•¡ì…˜ì„ ì¢…ë£Œí•©ë‹ˆë‹¤."
            echo "continue=false" >> $GITHUB_OUTPUT
          else
            echo "continue=true" >> $GITHUB_OUTPUT
          fi

  move-issue-to-in-progress:
    runs-on: ubuntu-latest
    needs: filter-branch # filter-branch ì•¡ì…˜ì„ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰í–ˆì„ ë•Œë§Œ ì‹¤í–‰
    if: needs.filter-branch.outputs.continue == 'true' # filter-branch ì•¡ì…˜ì´ trueì¼ ë•Œë§Œ ì‹¤í–‰
    steps:
      # ì•¡ì…˜ì— í•„ìš”í•œ íŒŒì¼ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ì‘ì—…
      - name: Checkout Action
        uses: actions/checkout@v4 # https://github.com/actions/checkout
        with:
          token: ${{ secrets.GITHUB_TOKEN }} # Github Actionsì—ì„œ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ í† í°
          fetch-depth: 1 # ê°€ì¥ ìµœê·¼ ì»¤ë°‹ë§Œ ê°€ì ¸ì˜¤ê¸°
          sparse-checkout: .github/actions # ì•¡ì…˜ ë””ë ‰í† ë¦¬ë§Œ ê°€ì ¸ì˜¤ê¸°

      # Node.js í™˜ê²½ ì„¤ì •
      - name: Setup Node.js Environment
        uses: ./.github/actions/setup-node

      # PRì„ In Progress Pipelineìœ¼ë¡œ ì´ë™í•˜ëŠ” ì‘ì—…
      - name: Move to In Progress Pipeline
        uses: ./.github/actions/zenhub-move-issue
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          zenhub_token: ${{ secrets.ZENHUB_TOKEN }}
          workspace_id: ${{ vars.ZENHUB_WORKSPACE_ID }} # https://github.com/ZenHubIO/API?tab=readme-ov-file#notes-1
          pipeline_id: ${{ vars.ZENHUB_IN_PROGRESS_PIPELINE_ID }}
